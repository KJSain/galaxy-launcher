- name: Create tool list directory on the server
  file:
    path="{{work_dir}}"
    state=directory

- name: Move tool lists on galaxy server
  copy:
    dest="{{work_dir}}/{{item}}"
    src="{{tool_list_dir}}/{{item}}"
    force=yes
  with_items: "{{tool_list_files}}"

- name: insert api key in files
  lineinfile:
    destfile="{{work_dir}}/{{item}}"
    regexp="api_key:.*"
    line="api_key{{':'}} {{galaxy_master_api_key}}"
  with_items: "{{tool_list_files}}"

- name: insert galaxy_instance in files
  lineinfile:
    destfile="{{work_dir}}/{{item}}"
    regexp="galaxy_instance:.*"
    line="galaxy_instance{{':'}} 127.0.0.1"
  with_items: "{{tool_list_files}}"

- name: get galaxy root directory from container
  command: "docker exec {{docker_container_name}} bash -c 'echo \"$GALAXY_ROOT\"'"
  register: galaxy_root

- debug: var=galaxy_root

- name: Move tool lists into the docker container
  command: "docker cp {{work_dir}}/{{item}} {{docker_container_name}}:{{galaxy_root.stdout}}/{{item}}"
  with_items: "{{tool_list_files}}"

- name: Install tool lists in docker container
  command: "docker exec /usr/bin/install-tools {{galaxy_root.stdout}}/{{item}}"
  with_items: "{{tool_list_files}}"
  register: install

- debug: var=install
