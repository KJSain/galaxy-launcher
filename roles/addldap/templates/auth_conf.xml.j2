<?xml version="1.0"?>
<auth>
    <authenticator>
        <type>ldap</type>
        <options>
            <allow-password-change>{{ldap.allow_password_change|default('False')}}</allow-password-change>
            <allow-register>{{ldap.allow_register | default('True')}}</allow-register>
            <auto-register>{{ldap.auto_register|default('False')}}</auto-register> 
            <continue-on-failure>{{ldap.continue_on_failure | default('False')}}</continue-on-failure>

            <server>{{ldap.server}}</server>
            {% if ldap.options is defined %}   
            <ldap-options>{{ldap.options}}</ldap-options>
            {% endif %}

            <search-fields>sAMAccountName,mail</search-fields>
            <search-base>{{ldap.search_base}}</search-base>
            <login-use-username>{{ldap.login_use_username| default('False')}}</login-use-username>
            {% if ldap.login_use_username %}
            <search-filter>(&amp;(objectClass=user)(mail={email}))</search-filter>
            {% else %}
            <search-filter>(&amp;(objectClass=user)(mail={email}))</search-filter>
            {% endif %}
            <bind-user>{sAMAccountName}@{{ldap.server | regex_replace('(ldap:\/\/)([a-zA-Z0-9.\/]*)(:?[0-9]*)','\\2')}}</bind-user>
            <bind-password>{password}</bind-password>
            <auto-register-username>{sAMAccountName}</auto-register-username>
            <auto-register-email>{mail}</auto-register-email>

        </options>
    </authenticator>
</auth>
